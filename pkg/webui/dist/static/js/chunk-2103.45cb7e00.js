(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-2103"],{"1/rA":function(e,t,a){"use strict";var i=a("7cXN");a.n(i).a},"144x":function(e,t,a){"use strict";a.r(t);var i=a("lvvV"),n=a("G4B5");for(var r in n)"default"!==r&&function(e){a.d(t,e,function(){return n[e]})}(r);a("1/rA");var o=a("KHd+"),s=Object(o.a)(n.default,i.a,i.b,!1,null,null,null);s.options.__file="role.vue",t.default=s.exports},"6g3Z":function(e,t,a){"use strict";a.r(t);var i=a("M3qR"),n=a.n(i);for(var r in i)"default"!==r&&function(e){a.d(t,e,function(){return i[e]})}(r);t.default=n.a},"7cXN":function(e,t,a){},Ah3l:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=m(a("P2sY")),n=m(a("jWXv")),r=m(a("rfXi")),o=m(a("4d7F")),s=a("zF5t"),l=a("WRkR"),d=a("Hycs"),u=m(a("Mz3J")),c=a("T8rL");function m(e){return e&&e.__esModule?e:{default:e}}t.default={name:"Role",components:{Pagination:u.default},data:function(){return{tableKey:0,list:null,total:0,listLoading:!0,listQuery:{page:1,skip:0,limit:20,q:""},sortOptions:[{label:"ID Ascending",key:"+id"},{label:"ID Descending",key:"-id"}],department:["admin","editor"],showReviewer:!1,temp:{id:void 0,name:"",remark:"",role_name:"",menu_ids:[],domain_id:""},dialogFormVisible:!1,dialogStatus:"create",textMap:{update:"Edit",create:"Create"},rules:{type:[{required:!0,message:"type is required",trigger:"change"}],timestamp:[{type:"date",required:!0,message:"timestamp is required",trigger:"change"}],name:[{required:!0,message:"角色名必须填写",trigger:"blur"}],remark:[{required:!0,message:"备注必须填写",trigger:"blur"}]},downloadLoading:!1,tree_data:[],tree_data_perm:[],tree_props:{children:"children",label:"name"},domainlist:[],domain_id:"",search_domain_id:"",menuslist:[],scopeType:1}},created:function(){this.getDeptList(),this.getList()},methods:{getList:function(){var e=this;this.listLoading=!0,this.listQuery.skip=(this.listQuery.page-1)*this.listQuery.limit,(0,s.fetchRoleList)(this.listQuery).then(function(t){e.list=t.data.result,e.total=t.data.total,e.listLoading=!1})},toSearch:function(){""!==this.search_domain_id?this.listQuery.q="d="+this.search_domain_id:delete this.listQuery.q,this.getList()},getPermList:function(){var e=this;o.default.all([(0,d.fetchMenuList)({q:"d="+this.domain_id}),(0,c.dataPermList)({start:0,limit:20,q:"d="+this.domain_id})]).then(function(t){console.log(t);var a=t[0].data.result,i=t[1].data.result;a&&a.length>0?e.tree_data=e.o(a,0):e.tree_data=[],i&&i.length>0?e.tree_data_perm=e.o(i,0):e.tree_data_perm=[];var n=e.temp,r=n.menu_ids_ele,o=void 0===r?"":r,s=n.data_perm_ids,l=void 0===s?"":s;e.$refs.tree.setCheckedKeys(o.split(",")),e.$refs.treeData.setCheckedKeys(l.split(","))})},getDeptList:function(){var e=this;(0,l.fetchDomainList)().then(function(t){e.domainlist=t.data.result,e.listLoading=!1})},o:function(e,t){var a=this,i=e.filter(function(e){return parseInt(e.parent_id)===parseInt(t)&&e.domain_id>0});return i.forEach(function(t){t.children=a.o(e,t.id)}),i},handleFilter:function(){this.listQuery.page=1,this.getList()},handleModifyStatus:function(e,t){this.$message({message:"操作成功",type:"success"}),e.status=t},sortChange:function(e){var t=e.prop,a=e.order;"id"===t&&this.sortByID(a)},sortByID:function(e){this.listQuery.sort="ascending"===e?"+id":"-id",this.handleFilter()},resetTemp:function(){this.temp={id:void 0,name:"",role_name:"",remark:"",menu_ids:[],domain_id:""},this.domain_id=""},handleCreate:function(){var e=this;this.resetTemp(),this.domainlist.length>0&&(this.domain_id=this.domainlist[0].id),this.getPermList(),this.dialogStatus="create",this.dialogFormVisible=!0,this.$nextTick(function(){e.$refs.dataForm.clearValidate()})},createData:function(){var e=this;this.$refs.dataForm.validate(function(t){if(t){e.temp.author="vue-element-admin",e.temp.role_name=e.temp.name,e.temp.menu_ids_ele=e.$refs.tree.getCheckedKeys().join(",");var a=[],i=[];e.$refs.tree.getCheckedKeys().forEach(function(e){a.push(e)}),e.$refs.treeData.getCheckedKeys().forEach(function(e){i.push(e)}),e.temp.menu_ids=(0,r.default)(new n.default(a)).join(","),e.temp.data_perm_ids=(0,r.default)(new n.default(i)).join(","),e.temp.domain_id=e.domain_id,(0,s.createRole)(e.temp).then(function(){e.getList(),e.tree_data=[],e.dialogFormVisible=!1,e.$notify({title:"成功",message:"创建成功",type:"success",duration:2e3})}).catch(function(t){e.$message.error(t.msg)})}})},handleUpdate:function(e){var t=this;this.temp=(0,i.default)({},e),this.temp.timestamp=new Date(this.temp.timestamp),this.dialogStatus="update",this.domain_id=this.temp.domain.id,this.getPermList(),this.dialogFormVisible=!0,this.$nextTick(function(){t.$refs.dataForm.clearValidate()})},findParentMenus:function(e,t){var a=this.menuslist.find(function(e){return e.id===t});a&&"0"!==a.parent_id&&(e.push(a.parent_id),this.findParentMenus(e,a.parent_id))},updateData:function(){var e=this;this.$refs.dataForm.validate(function(t){if(t){e.temp.role_name=e.temp.name,e.temp.menu_ids_ele=e.$refs.tree.getCheckedKeys().join(",");var a=[],o=[];e.$refs.tree.getCheckedKeys().forEach(function(t){a.push(t),e.findParentMenus(a,t)}),e.$refs.treeData.getCheckedKeys().forEach(function(e){o.push(e)}),e.temp.menu_ids=(0,r.default)(new n.default(a)).join(","),e.temp.data_perm_ids=(0,r.default)(new n.default(o)).join(","),e.temp.domain_id=e.domain_id,delete e.temp.domain;var l=(0,i.default)({},e.temp);l.timestamp=+new Date(l.timestamp),(0,s.updateRole)(l).then(function(){e.getList(),e.tree_data=[],e.dialogFormVisible=!1,e.$notify({title:"成功",message:"更新成功",type:"success",duration:2e3})}).catch(function(t){e.$message.error(t.msg)})}})},handleDelete:function(e){var t=this;this.$confirm("<span>删除后，拥有该角色的用户相关权限将受到影响，</span>你还要继续吗?","删除角色",{confirmButtonText:"继续",cancelButtonText:"取消",type:"warning",dangerouslyUseHTMLString:!0}).then(function(){(0,s.deleteRole)({id:e.id}).then(function(){t.$notify({title:"成功",message:"删除成功",type:"success",duration:2e3}),t.getList()}).catch(function(e){t.$message.error(e.msg)})}).catch(function(){})}}}},G4B5:function(e,t,a){"use strict";a.r(t);var i=a("Ah3l"),n=a.n(i);for(var r in i)"default"!==r&&function(e){a.d(t,e,function(){return i[e]})}(r);t.default=n.a},HKPr:function(e,t,a){"use strict";var i=a("YPLS");a.n(i).a},Hycs:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fetchMenuList=function(e){return(0,i.default)({url:"v1/menus",method:"get",params:e})},t.fetchMenu=function(e){return(0,i.default)({url:"v1/menus",method:"get",params:{id:e}})},t.createMenu=function(e){return(0,i.default)({url:"v1/menus",method:"post",data:n.default.stringify(e)})},t.updateMenu=function(e){return(0,i.default)({url:"v1/menus/"+e.id,method:"put",data:n.default.stringify(e)})},t.deleteMenu=function(e){return(0,i.default)({url:"v1/menus/"+e.id,method:"delete",data:n.default.stringify(e)})};var i=r(a("t3Un")),n=r(a("Qyje"));function r(e){return e&&e.__esModule?e:{default:e}}},Jdhx:function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"pagination-container",class:{hidden:e.hidden}},[a("el-pagination",e._b({attrs:{background:e.background,"current-page":e.currentPage,"page-size":e.pageSize,layout:e.layout,"page-sizes":e.pageSizes,total:e.total},on:{"update:currentPage":function(t){e.currentPage=t},"update:pageSize":function(t){e.pageSize=t},"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}},"el-pagination",e.$attrs,!1))],1)},n=[];a.d(t,"a",function(){return i}),a.d(t,"b",function(){return n})},M3qR:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("Y5bG");t.default={name:"Pagination",props:{total:{required:!0,type:Number},page:{type:Number,default:1},limit:{type:Number,default:20},pageSizes:{type:Array,default:function(){return[10,20,30,50]}},layout:{type:String,default:"total, sizes, prev, pager, next, jumper"},background:{type:Boolean,default:!0},autoScroll:{type:Boolean,default:!0},hidden:{type:Boolean,default:!1}},computed:{currentPage:{get:function(){return this.page},set:function(e){this.$emit("update:page",e)}},pageSize:{get:function(){return this.limit},set:function(e){this.$emit("update:limit",e)}}},methods:{handleSizeChange:function(e){this.$emit("pagination",{page:this.currentPage,limit:e}),this.autoScroll&&(0,i.scrollTo)(0,800)},handleCurrentChange:function(e){this.$emit("pagination",{page:e,limit:this.pageSize}),this.autoScroll&&(0,i.scrollTo)(0,800)}}}},Mz3J:function(e,t,a){"use strict";a.r(t);var i=a("Jdhx"),n=a("6g3Z");for(var r in n)"default"!==r&&function(e){a.d(t,e,function(){return n[e]})}(r);a("HKPr");var o=a("KHd+"),s=Object(o.a)(n.default,i.a,i.b,!1,null,"cebf2f0c",null);s.options.__file="index.vue",t.default=s.exports},T8rL:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.dataPermList=function(e){return(0,i.default)({url:"v1/datas",method:"get",params:e})},t.dataPermDel=function(e){return(0,i.default)({url:"v1/datas/"+e.id,method:"delete",params:e})},t.dataPermAdd=function(e){return(0,i.default)({url:"v1/datas",method:"post",data:n.default.stringify(e)})},t.dataPermEdit=function(e){return(0,i.default)({url:"v1/datas/"+e.id,method:"put",data:n.default.stringify(e)})};var i=r(a("t3Un")),n=r(a("Qyje"));function r(e){return e&&e.__esModule?e:{default:e}}},WRkR:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fetchDomainList=function(e){return(0,i.default)({url:"v1/domains",method:"get",params:e})},t.fetchDomain=function(e){return(0,i.default)({url:"v1/domains"+e,method:"get"})},t.createDomain=function(e){return(0,i.default)({url:"v1/domains",method:"post",data:n.default.stringify(e)})},t.updateDomain=function(e,t){return(0,i.default)({url:"v1/domains/"+e,method:"put",data:n.default.stringify(t)})},t.deleteDomain=function(e,t){return(0,i.default)({url:"v1/domains/"+e,method:"delete",data:n.default.stringify(t)})};var i=r(a("t3Un")),n=r(a("Qyje"));function r(e){return e&&e.__esModule?e:{default:e}}},Y5bG:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.scrollTo=function(e,t,a){var n=document.documentElement.scrollTop||document.body.parentNode.scrollTop||document.body.scrollTop,r=e-n,o=0;t=void 0===t?500:t,function e(){o+=20;var s=Math.easeInOutQuad(o,n,r,t);!function(e){document.documentElement.scrollTop=e,document.body.parentNode.scrollTop=e,document.body.scrollTop=e}(s),o<t?i(e):a&&"function"==typeof a&&a()}()},Math.easeInOutQuad=function(e,t,a,i){return(e/=i/2)<1?a/2*e*e+t:-a/2*(--e*(e-2)-1)+t};var i=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}},YPLS:function(e,t,a){},lvvV:function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container"},[a("div",{staticClass:"filter-container"},[a("el-select",{staticClass:"filter-item",attrs:{placeholder:"Please select"},on:{change:e.toSearch},model:{value:e.search_domain_id,callback:function(t){e.search_domain_id=t},expression:"search_domain_id"}},[a("el-option",{key:"",attrs:{label:"全部",value:""}}),e._v(" "),e._l(e.domainlist,function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})],2),e._v(" "),a("el-button",{directives:[{name:"waves",rawName:"v-waves"}],staticClass:"filter-item",attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.toSearch}},[e._v("\n      "+e._s(e.$t("table.search"))+"\n    ")]),e._v(" "),a("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["/permission/role:add"],expression:"['/permission/role:add']"}],staticClass:"filter-item",staticStyle:{"margin-left":"10px"},attrs:{type:"primary",icon:"el-icon-edit"},on:{click:e.handleCreate}},[e._v(e._s(e.$t("table.add"))+"\n    ")])],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],key:e.tableKey,staticStyle:{width:"100%"},attrs:{data:e.list,border:"",fit:"","highlight-current-row":""},on:{"sort-change":e.sortChange}},[a("el-table-column",{attrs:{label:e.$t("role.id"),prop:"id",align:"center",width:"65"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.id))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:e.$t("role.name"),"min-width":"150px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.name)+"\n      ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:e.$t("role.dept")},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.domain.name)+"\n      ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:e.$t("role.remark")},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.remark)+"\n      ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:e.$t("role.actions"),align:"center",width:"200","class-name":"small-padding fixed-width"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["/permission/role:edit"],expression:"['/permission/role:edit']"}],attrs:{type:"primary",size:"mini"},on:{click:function(a){e.handleUpdate(t.row)}}},[e._v(e._s(e.$t("table.edit"))+"\n        ")]),e._v(" "),a("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["/permission/role:del"],expression:"['/permission/role:del']"}],attrs:{type:"danger",size:"mini"},on:{click:function(a){e.handleDelete(t.row)}}},[e._v("\n          "+e._s(e.$t("table.delete"))+"\n        ")])]}}])})],1),e._v(" "),a("pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total>0"}],attrs:{total:e.total,page:e.listQuery.page,limit:e.listQuery.limit},on:{"update:page":function(t){e.$set(e.listQuery,"page",t)},"update:limit":function(t){e.$set(e.listQuery,"limit",t)},pagination:e.getList}}),e._v(" "),a("el-dialog",{attrs:{title:e.$t("user."+e.textMap[e.dialogStatus]),visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("el-form",{ref:"dataForm",staticStyle:{margin:"0 50px"},attrs:{rules:e.rules,model:e.temp,"label-position":"left","label-width":"80px"}},[a("el-form-item",{attrs:{label:e.$t("role.name"),prop:"name"}},[a("el-input",{model:{value:e.temp.name,callback:function(t){e.$set(e.temp,"name",t)},expression:"temp.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e.$t("role.remark")}},[a("el-input",{model:{value:e.temp.remark,callback:function(t){e.$set(e.temp,"remark",t)},expression:"temp.remark"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e.$t("role.domain")}},[a("el-select",{staticClass:"filter-item",attrs:{disabled:"create"!==e.dialogStatus,placeholder:"Please select"},on:{change:e.getPermList},model:{value:e.domain_id,callback:function(t){e.domain_id=t},expression:"domain_id"}},e._l(e.domainlist,function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:e.$t("role.menuscope")}},[a("el-radio-group",{staticClass:"radio",model:{value:e.scopeType,callback:function(t){e.scopeType=t},expression:"scopeType"}},[a("el-radio-button",{attrs:{label:"1"}},[e._v(e._s(e.$t("role.menuscope")))]),e._v(" "),a("el-radio-button",{attrs:{label:"2"}},[e._v(e._s(e.$t("role.datascope")))])],1),e._v(" "),a("el-tree",{directives:[{name:"show",rawName:"v-show",value:1===parseInt(e.scopeType),expression:"parseInt(scopeType) === 1"}],ref:"tree",attrs:{data:e.tree_data,props:e.tree_props,"show-checkbox":"","node-key":"id"}}),e._v(" "),a("el-tree",{directives:[{name:"show",rawName:"v-show",value:2===parseInt(e.scopeType),expression:"parseInt(scopeType) === 2"}],ref:"treeData",attrs:{data:e.tree_data_perm,props:e.tree_props,"show-checkbox":"","node-key":"id"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogFormVisible=!1,e.tree_data=[]}}},[e._v(e._s(e.$t("table.cancel")))]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){"create"===e.dialogStatus?e.createData():e.updateData()}}},[e._v(e._s(e.$t("table.confirm"))+"\n      ")])],1)],1)],1)},n=[];a.d(t,"a",function(){return i}),a.d(t,"b",function(){return n})},zF5t:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fetchRoleList=function(e){return(0,i.default)({url:"v1/roles",method:"get",params:e})},t.fetchRole=function(e){return(0,i.default)({url:"role/show",method:"get",params:{id:e}})},t.createRole=function(e){return(0,i.default)({url:"v1/roles",method:"post",data:n.default.stringify(e)})},t.updateRole=function(e){return(0,i.default)({url:"v1/roles/"+e.id,method:"put",data:n.default.stringify(e)})},t.deleteRole=function(e){return(0,i.default)({url:"v1/roles/"+e.id,method:"delete",data:n.default.stringify(e)})};var i=r(a("t3Un")),n=r(a("Qyje"));function r(e){return e&&e.__esModule?e:{default:e}}}}]);