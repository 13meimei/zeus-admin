(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-2f89"],{"/gXl":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fetchDeptList=function(e){return(0,i.default)({url:"v1/depts",method:"get",params:e})},t.fetchDept=function(e){return(0,i.default)({url:"v1/depts",method:"get",params:{id:e}})},t.createDept=function(e){return(0,i.default)({url:"v1/depts",method:"post",data:a.default.stringify(e)})},t.updateDept=function(e,t){return(0,i.default)({url:"v1/depts/"+e,method:"put",data:a.default.stringify(t)})},t.checkMemberDept=function(e){return(0,i.default)({url:"v1/depts/"+e.id+"/check-no-member",method:"post",data:a.default.stringify(e)})},t.deleteDept=function(e){return(0,i.default)({url:"v1/depts/"+e.id,method:"delete",data:a.default.stringify(e)})};var i=r(n("t3Un")),a=r(n("Qyje"));function r(e){return e&&e.__esModule?e:{default:e}}},"1XQY":function(e,t,n){"use strict";var i=n("jZRq");n.n(i).a},"6bP5":function(e,t,n){"use strict";var i=n("Qq1u");n.n(i).a},"6g3Z":function(e,t,n){"use strict";n.r(t);var i=n("M3qR"),a=n.n(i);for(var r in i)"default"!==r&&function(e){n.d(t,e,function(){return i[e]})}(r);t.default=a.a},"7SP9":function(e,t,n){"use strict";n.r(t);var i=n("hYG2"),a=n.n(i);for(var r in i)"default"!==r&&function(e){n.d(t,e,function(){return i[e]})}(r);t.default=a.a},Dh5b:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(n("rfXi"));t.default=function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;var s=[];(0,i.default)(t).forEach(function(t){void 0===t._expanded&&a.default.set(t,"_expanded",n);var i=1;if(void 0!==o&&null!==o&&(i=o+1),a.default.set(t,"_level",i),r&&a.default.set(t,"parent",r),s.push(t),t.children&&t.children.length>0){var l=e(t.children,n,t,i);s=s.concat(l)}});return s};var a=r(n("Kw5r"));function r(e){return e&&e.__esModule?e:{default:e}}},HKPr:function(e,t,n){"use strict";var i=n("YPLS");n.n(i).a},Jdhx:function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"pagination-container",class:{hidden:e.hidden}},[n("el-pagination",e._b({attrs:{background:e.background,"current-page":e.currentPage,"page-size":e.pageSize,layout:e.layout,"page-sizes":e.pageSizes,total:e.total},on:{"update:currentPage":function(t){e.currentPage=t},"update:pageSize":function(t){e.pageSize=t},"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}},"el-pagination",e.$attrs,!1))],1)},a=[];n.d(t,"a",function(){return i}),n.d(t,"b",function(){return a})},M3qR:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n("Y5bG");t.default={name:"Pagination",props:{total:{required:!0,type:Number},page:{type:Number,default:1},limit:{type:Number,default:20},pageSizes:{type:Array,default:function(){return[10,20,30,50]}},layout:{type:String,default:"total, sizes, prev, pager, next, jumper"},background:{type:Boolean,default:!0},autoScroll:{type:Boolean,default:!0},hidden:{type:Boolean,default:!1}},computed:{currentPage:{get:function(){return this.page},set:function(e){this.$emit("update:page",e)}},pageSize:{get:function(){return this.limit},set:function(e){this.$emit("update:limit",e)}}},methods:{handleSizeChange:function(e){this.$emit("pagination",{page:this.currentPage,limit:e}),this.autoScroll&&(0,i.scrollTo)(0,800)},handleCurrentChange:function(e){this.$emit("pagination",{page:e,limit:this.pageSize}),this.autoScroll&&(0,i.scrollTo)(0,800)}}}},Mz3J:function(e,t,n){"use strict";n.r(t);var i=n("Jdhx"),a=n("6g3Z");for(var r in a)"default"!==r&&function(e){n.d(t,e,function(){return a[e]})}(r);n("HKPr");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"cebf2f0c",null);s.options.__file="index.vue",t.default=s.exports},Qd7o:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(n("rfXi"));t.default=function e(t,n,r,o,s){var l=[];var u=[];(0,i.default)(t).forEach(function(t){void 0===t._expanded&&a.default.set(t,"_expanded",n);var i=1;if(void 0!==o&&null!==o&&(i=o+1),a.default.set(t,"_level",i),r?(a.default.set(t,"parent",r),l[i]||(l[i]=0),a.default.set(t,"_marginLeft",l[i]+r._marginLeft),a.default.set(t,"_width",t[s]/r[s]*r._width),l[i]+=t._width):(l[t.id]=[],l[t.id][i]=0,a.default.set(t,"_marginLeft",0),a.default.set(t,"_width",1)),u.push(t),t.children&&t.children.length>0){var d=e(t.children,n,t,i,s);u=u.concat(d)}});return u};var a=r(n("Kw5r"));function r(e){return e&&e.__esModule?e:{default:e}}},Qq1u:function(e,t,n){},Sf9I:function(e,t,n){"use strict";n.r(t);var i=n("hc7K"),a=n.n(i);for(var r in i)"default"!==r&&function(e){n.d(t,e,function(){return i[e]})}(r);t.default=a.a},"W+lF":function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-table",e._b({attrs:{data:e.formatData,"row-style":e.showRow}},"el-table",e.$attrs,!1),[0===e.columns.length?n("el-table-column",{attrs:{width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._l(t.row._level,function(e){return n("span",{key:e,staticClass:"ms-tree-space"})}),e._v(" "),e.iconShow(0,t.row)?n("span",{staticClass:"tree-ctrl",on:{click:function(n){e.toggleExpanded(t.$index)}}},[t.row._expanded?n("i",{staticClass:"el-icon-minus"}):n("i",{staticClass:"el-icon-plus"})]):e._e(),e._v("\n      "+e._s(t.$index)+"\n    ")]}}])}):e._l(e.columns,function(t,i){return n("el-table-column",{key:t.value,attrs:{label:t.text,width:t.width},scopedSlots:e._u([{key:"default",fn:function(a){return[e._l(a.row._level,function(t){return 0===i?n("span",{key:t,staticClass:"ms-tree-space"}):e._e()}),e._v(" "),e.iconShow(i,a.row)?n("span",{staticClass:"tree-ctrl",on:{click:function(t){e.toggleExpanded(a.$index)}}},[a.row._expanded?n("i",{staticClass:"el-icon-minus"}):n("i",{staticClass:"el-icon-plus"})]):e._e(),e._v("\n      "+e._s(a.row[t.value])+"\n    ")]}}])})}),e._v(" "),e._t("default")],2)},a=[];n.d(t,"a",function(){return i}),n.d(t,"b",function(){return a})},Y5bG:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.scrollTo=function(e,t,n){var a=document.documentElement.scrollTop||document.body.parentNode.scrollTop||document.body.scrollTop,r=e-a,o=0;t=void 0===t?500:t,function e(){o+=20;var s=Math.easeInOutQuad(o,a,r,t);!function(e){document.documentElement.scrollTop=e,document.body.parentNode.scrollTop=e,document.body.scrollTop=e}(s),o<t?i(e):n&&"function"==typeof n&&n()}()},Math.easeInOutQuad=function(e,t,n,i){return(e/=i/2)<1?n/2*e*e+t:-n/2*(--e*(e-2)-1)+t};var i=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}},YPLS:function(e,t,n){},"d/Ye":function(e,t,n){"use strict";var i=n("fxuI");n.n(i).a},fxuI:function(e,t,n){},hYG2:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=u(n("gDS+")),a=u(n("P2sY")),r=u(n("itRl")),o=u(n("Qd7o")),s=n("/gXl"),l=u(n("Mz3J"));function u(e){return e&&e.__esModule?e:{default:e}}t.default={name:"Dept",components:{Pagination:l.default,treeTable:r.default},data:function(){return{func:o.default,args:[null,null,"timeLine"],columns:[{value:"name",text:this.$t("dept.name")}],expandAll:!1,treeList:{},index:1,tableKey:0,list:null,total:0,listLoading:!0,listQuery:{page:1,skip:0,limit:20,importance:void 0,title:void 0,type:void 0,sort:"+id"},department:["admin","editor"],showReviewer:!1,temp:{id:void 0,name:"",remark:"",callbackurl:"",parents:["0"]},dialogFormVisible:!1,dialogStatus:"create",textMap:{update:"Edit",create:"Create"},rules:{type:[{required:!0,message:"type is required",trigger:"change"}],timestamp:[{type:"date",required:!0,message:"timestamp is required",trigger:"change"}],name:[{required:!0,message:"名称必须填写",trigger:"blur"}]},downloadLoading:!1,tree_data:[],tree_props:{children:"children",label:"name"}}},created:function(){this.getList()},methods:{getList:function(){var e=this;this.listLoading=!0,this.listQuery.skip=(this.listQuery.page-1)*this.listQuery.limit,(0,s.fetchDeptList)(this.listQuery).then(function(t){e.list=t.data.result,e.total=t.data.total,e.treeList=e.o(t.data.result,0),e.listLoading=!1})},handleFilter:function(){this.listQuery.page=1,this.getList()},handleModifyStatus:function(e,t){this.$message({message:"操作成功",type:"success"}),e.status=t},sortChange:function(e){var t=e.prop,n=e.order;"id"===t&&this.sortByID(n)},sortByID:function(e){this.listQuery.sort="ascending"===e?"+id":"-id",this.handleFilter()},resetTemp:function(){this.temp={id:void 0,name:"",remark:"",callbackurl:"",parents:["0"]}},handleCreate:function(){var e=this;this.resetTemp(),this.dialogStatus="create",this.dialogFormVisible=!0,this.$nextTick(function(){e.$refs.dataForm.clearValidate()})},createData:function(){var e=this;this.$refs.dataForm.validate(function(t){t&&(e.temp.id=parseInt(100*Math.random())+1024,e.temp.author="vue-element-admin",e.temp.parent_id=e.temp.parents[e.temp.parents.length-1],delete e.temp.parent,(0,s.createDept)(e.temp).then(function(){e.getList(),e.dialogFormVisible=!1,e.$notify({title:"成功",message:"创建成功",type:"success",duration:2e3})}).catch(function(t){e.$message.error(t.msg)}))})},handleUpdate:function(e){var t=this;this.temp=(0,a.default)({},e),this.temp.timestamp=new Date(this.temp.timestamp),this.dialogStatus="update",this.dialogFormVisible=!0,this.temp.parents=[],this.findParent(this.temp.id,this.temp.parents,this.list),this.temp.parents.reverse(),this.$nextTick(function(){t.$refs.dataForm.clearValidate()})},updateData:function(){var e=this;this.$refs.dataForm.validate(function(t){if(t){delete e.temp.children;var n=(0,a.default)({},e.temp);n.timestamp=+new Date(n.timestamp),n.parent_id=n.parents[e.temp.parents.length-1],delete n.parent,(0,s.updateDept)(e.temp.id,n).then(function(){e.getList(),e.dialogFormVisible=!1,e.$notify({title:"成功",message:"更新成功",type:"success",duration:2e3})}).catch(function(t){e.$message.error(t.msg)})}})},handleDelete:function(e){var t=this;(0,s.checkMemberDept)({id:e.id}).then(function(n){t.$confirm("<span>删除后，该部门名称可进行复用</span>","删除部门",{confirmButtonText:"继续",cancelButtonText:"取消",type:"warning",dangerouslyUseHTMLString:!0}).then(function(){(0,s.deleteDept)({id:e.id}).then(function(){t.$notify({title:"成功",message:"删除成功",type:"success",duration:2e3}),t.getList()}).catch(function(e){t.$message.error(e.msg)})}).catch(function(){})}).catch(function(e){t.$alert("部门内仍有用户，请先将用户转移至其他部门再进行删除","不可删除部门",{confirmButtonText:"确定",type:"warning"})})},handleLook:function(e){this.$router.push({path:"/permission/dept/member?dept="+e.id})},o:function(e,t){var n=this,i=e.filter(function(e){return e.parent_id===t});return i.forEach(function(t){console.log(t.id);var i=n.o(e,t.id);i&&i.length>0&&(t.children=i)}),i},recursive:function(e,t){var n=this,a=[],r=[],o=1;return e.forEach(function(e){if(e.permission||!1!==e.permission){if(r={name:n.$t("route."+e.meta.title),label:n.$t("route."+e.meta.title),icon:e.meta.icon,id:n.index,value:n.index,order_num:o,url:"{}"===(0,i.default)(t)?e.path:t.url+"/"+e.path,parent_id:"{}"===(0,i.default)(t)?0:t.id,perms:"",alias:"",menu_type:"1"},n.index+=1,o+=1,e.children&&Array.isArray(e.children)&&(r.children=n.recursive(e.children,r)),e.auth&&Array.isArray(e.auth)){var s=[],l={},u=1;e.auth.forEach(function(e){l={name:e.name,label:e.name,icon:"",id:n.index,value:n.index,order_num:u,url:"",parent_id:r.id,perms:r.url+":"+e.code,menu_type:"2"},s.push(l),n.index+=1,u+=1}),r.children=s}a.push(r)}}),a},findParent:function(e,t,n){var i=this;return n.forEach(function(n){n.id===e&&(t.push(n.parent_id),i.findParent(n.parent_id,t,i.treeList)),n.children&&Array.isArray(n.children)&&i.findParent(e,t,n.children)}),t}}}},hc7K:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(n("jr1U")),a=r(n("Dh5b"));function r(e){return e&&e.__esModule?e:{default:e}}t.default={name:"TreeTable",props:{data:{type:[Array,Object],required:!0},columns:{type:Array,default:function(){return[]}},evalFunc:Function,evalArgs:Array,expandAll:{type:Boolean,default:!1}},computed:{formatData:function(){var e=void 0;e=Array.isArray(this.data)?this.data:[this.data];var t=this.evalFunc||a.default,n=this.evalArgs?(0,i.default)([e,this.expandAll],this.evalArgs):[e,this.expandAll];return t.apply(null,n)}},methods:{showRow:function(e){var t=!e.row.parent||e.row.parent._expanded&&e.row.parent._show;return e.row._show=t,t?"animation:treeTableShow 1s;-webkit-animation:treeTableShow 1s;":"display:none;"},toggleExpanded:function(e){var t=this.formatData[e];t._expanded=!t._expanded},iconShow:function(e,t){return 0===e&&t.children&&t.children.length>0}}}},itRl:function(e,t,n){"use strict";n.r(t);var i=n("W+lF"),a=n("Sf9I");for(var r in a)"default"!==r&&function(e){n.d(t,e,function(){return a[e]})}(r);n("6bP5"),n("1XQY");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"60a8d106",null);s.options.__file="index.vue",t.default=s.exports},jZRq:function(e,t,n){},jr1U:function(e,t,n){e.exports={default:n("wObO"),__esModule:!0}},mJm7:function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"app-container"},[n("div",{staticClass:"filter-container"},[n("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["/permission/dept:add"],expression:"['/permission/dept:add']"}],staticClass:"filter-item",staticStyle:{"margin-left":"10px"},attrs:{type:"primary",icon:"el-icon-edit"},on:{click:e.handleCreate}},[e._v(e._s(e.$t("table.add"))+"\n    ")])],1),e._v(" "),n("tree-table",{attrs:{data:e.treeList,"eval-func":e.func,"eval-args":e.args,columns:e.columns,"expand-all":e.expandAll,border:""}},[n("el-table-column",{attrs:{label:e.$t("dept.id"),prop:"id",align:"center",width:"65"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",[e._v(e._s(t.row.id))])]}}])}),e._v(" "),n("el-table-column",{attrs:{label:e.$t("dept.actions"),align:"center",width:"280","class-name":"small-padding fixed-width"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["/permission/dept:edit"],expression:"['/permission/dept:edit']"}],staticStyle:{width:"80px"},attrs:{type:"primary",size:"mini"},on:{click:function(n){e.handleLook(t.row)}}},[e._v(e._s(e.$t("table.look"))+"\n        ")]),e._v(" "),"未分配"!==t.row.name?n("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["/permission/dept:edit"],expression:"['/permission/dept:edit']"}],attrs:{type:"primary",size:"mini"},on:{click:function(n){e.handleUpdate(t.row)}}},[e._v(e._s(e.$t("table.edit"))+"\n        ")]):e._e(),e._v(" "),"未分配"!==t.row.name?n("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["/permission/dept:del"],expression:"['/permission/dept:del']"}],attrs:{type:"danger",size:"mini"},on:{click:function(n){e.handleDelete(t.row)}}},[e._v(e._s(e.$t("table.delete"))+"\n        ")]):e._e()]}}])})],1),e._v(" "),n("el-dialog",{attrs:{title:e.$t("user."+e.textMap[e.dialogStatus]),visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[n("el-form",{ref:"dataForm",staticStyle:{margin:"0 50px"},attrs:{rules:e.rules,model:e.temp,"label-position":"left","label-width":"80px"}},[n("el-form-item",{attrs:{label:e.$t("dept.name"),prop:"name"}},[n("el-input",{model:{value:e.temp.name,callback:function(t){e.$set(e.temp,"name",t)},expression:"temp.name"}})],1)],1),e._v(" "),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v(e._s(e.$t("table.cancel")))]),e._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:function(t){"create"===e.dialogStatus?e.createData():e.updateData()}}},[e._v(e._s(e.$t("table.confirm"))+"\n      ")])],1)],1)],1)},a=[];n.d(t,"a",function(){return i}),n.d(t,"b",function(){return a})},o7J3:function(e,t,n){"use strict";n.r(t);var i=n("mJm7"),a=n("7SP9");for(var r in a)"default"!==r&&function(e){n.d(t,e,function(){return a[e]})}(r);n("d/Ye");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"92bdb54e",null);s.options.__file="dept.vue",t.default=s.exports},wObO:function(e,t){e.exports=function(){return Function.call.apply(Array.prototype.concat,arguments)}}}]);